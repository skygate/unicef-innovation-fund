<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-styles/typography.html">

<dom-module id="project-modal">
  <template>
    <style is="custom-style">
      :host {
        display: block;
      }

      progress-bubble {
        display: inline-block;
        color: black;
        text-shadow: none;
        --progress-bubble-stroke-color: #ffe28a;
        --progress-bubble-stroke-linecap: butt;
        --progress-bubble-bg-stroke-color: rgb(186, 185, 185);
        --progress-bubble-background: transparent;
        --progress-bubble-reflection-display: none;
      }

      .card_text{
        font-size:13px;
      }
      span {
        @apply(--paper-font-body1);
      }
    </style>

    <firebase-document
      app-name="test"
      path="/budget"
      data="{{financials}}">
    </firebase-document>

    <div>
      <div data-dialog="animated" id='modal_ureport' onclick="clickHandler(event)"></div>

      <paper-dialog

        id="animated"
        style='border-top-left-radius:5px;border-top-right-radius:5px;'
        withBackdrop='false'

        entry-animation="scale-up-animation"
        exit-animation="fade-out-animation"
        with-backdrop>

        <span id='portfolio_project_kind' style='display:none;'> </span>

        <span id='portfolio_project_color' style='display:none;'> </span>

        <span id='portfolio_project_amount' style='display:none;'> </span>

        <paper-dialog-scrollable>
            <div id="card_linechart">
                <div class="mdl-grid" id='card_linechart'>
                    <div class="mdl-cell mdl-cell--7-col mdl-cell--8-col-tablet">
                        <paper-button dialog-confirm autofocus class="featured__close mdl-cell--hide-desktop">
                            <img style='cursor:pointer;width:20px;height:20px;' src='../images/close.svg'/>
                        </paper-button>
                        <div class='' style='text-align:left;'>
                            <span id='portfolio_project_name' style='font-size:18px;'> </span>
                            (<span id='portfolio_project_country' style='display:inline;'> </span>)
                        </div>
                        <chart-line id='modal_linechart' style='width:100%;margin:auto;' ></chart-line>
                    </div>

                    <div class="featured__details mdl-cell mdl-cell--5-col mdl-cell--8-col-tablet">
                        <paper-button dialog-confirm autofocus class="featured__close mdl-cell--hide-tablet">
                            <img style='cursor:pointer;width:20px;height:20px;' src='../images/close.svg'/>
                        </paper-button>
                        <h3 class="featured__name">Description</h3>
                        <div id='portfolio_project_description' class="featured__description" style='font-size:13px;'> </div>
                        <a id='project_link' class="featured__link" target='_blank' style='display:none;'></a>
                        <hr class="featured__divider">
                        <progress-bubble class="circullar-progress" id="progressBar" value="{{ _getProjectAmount(project) }}" max="{{ _getPortfolioBudget(project, financials) }}">
                            <strong>{{ _getProjectAmountString(project) }}</strong>
                        </progress-bubble>
                        <strong class="featured__name">Invested</strong>
                        <hr class="feature__divider">
                        <strong class="featured__number">0</strong> <strong>users</strong>
                        <select name="" id="" class="featured__select">
                            <option value="Option 1" class="featured__option">Option 1</option>
                            <option value="Option 2" class="featured__option">Option 2</option>
                            <option value="Option 3" class="featured__option">Option 3</option>
                        </select>
                    </div>
                </div>
            </div>

          <span id='card-iogt' style='padding:0px;display:none;'>
            <div class="mdl-grid">
              <div class="mdl-cell mdl-cell--12-col" >
                <div class="demo-card-event mdl-card mdl-shadow--4dp" style='width:100%;height100%;padding:0px;'>
                  <div class="mdl-card__title mdl-card--expand" style="width:100%;height100%;margin:auto;">
                    <chart-line id="iogt_linechart" style='width:100%;height100%;margin:auto;'></chart-line>
                  </div>
                </div>
              </div>
            </div>

            <div class="mdl-grid">
              <div class="mdl-cell mdl-cell--12-col" >
                <div class="demo-card-event mdl-card mdl-shadow--4dp" style='width:100%;'>
                  <div id="iogt_geo_chart" style="width:100%;"></div>
                  </div>
                </div>
              </div>
            </div>

          </span>
        </paper-dialog-scrollable>
      </paper-dialog>
    </div>

  </template>

  <script>
    (function() {
      'use strict';

      Polymer({
        is: 'project-modal',

        properties: {

          project: {
            type: Object,
            value: null
          }

        },

        ready: function(){
          this.$.animated.addEventListener('iron-overlay-opened', (function(){
            this.project = $(this.$.animated).data('project');
            this.$.progressBar.redraw();
          }).bind(this));
        },

        _getProjectAmount(project) {
          if (!project) {
            return 0;
          }

          var amount = parseInt(project.amount.replace(/\$|\,/g, ''));
          return amount;
        },

        _getProjectAmountString(project) {
          if (!project) {
            return '';
          }

          var amount = this._getProjectAmount(project);
          return cleanToMil(amount);
        },

        _getPortfolioBudget(project, financials) {
          if (!project || !project.portfolio_name || !financials) {
            return 0;
          }

          var budget = financials.totals[project.portfolio_name];
          return budget;
        }

      });
    })();
  </script>
</dom-module>
