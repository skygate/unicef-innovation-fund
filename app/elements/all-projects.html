<dom-module id='all-projects'>

  <template>
    <style>
      :host{
        display: block;
      }

      :host([active]) {
        display: block;
      }

      .project-info {
        background-color: #fff;
        padding: 16px;
      }

      .project-info__title {

      }

      .project-list {
        margin-top: -16px;
      }

    </style>

    <firebase-document
      app-name="test"
      path="content"
      data="{{content}}">
    </firebase-document>

    <firebase-document
      app-name="test"
      path="{{ location }}"
      data="{{ projectsData }}">
    </firebase-document>

    <div class='page'>
      <hello-all-projects all_projects_cloud_content="{{content.all_projects_cloud_content}}"></hello-all-projects>
      <div class="page__content">
        <div class="mdl-grid">
          <div class="content-column mdl-cell mdl-cell--3-col mdl-cell--4-col-tablet mdl-cell--4-col-phone">
            <project-card selected={{selected}} content="{{content.youth_engagement}}" phrase='Products For Youth' fb='ureport' svg="youth_engagement" rgb='255, 204, 51, 0.2'></project-card>
          </div>
          <div class="content-column mdl-cell mdl-cell--3-col mdl-cell--4-col-tablet mdl-cell--4-col-phone">
            <project-card selected={{selected}} content="{{content.real_time_info}}" phrase='Real-time Information' svg="real_time_information" rgb='255, 204, 51, 0.2'></project-card>
          </div>
          <div class="content-column mdl-cell mdl-cell--3-col mdl-cell--4-col-tablet mdl-cell--4-col-phone">
            <project-card selected={{selected}} content="{{content.infrastructure}}" phrase='Infrastructure' fb='iogt'  svg="infrastructure"   rgb='255, 204, 51, 0.2'></project-card>
          </div>
          <div class="content-column mdl-cell mdl-cell--3-col mdl-cell--4-col-tablet mdl-cell--4-col-phone">
            <project-card selected={{selected}} content="{{content.knowledge_p}}" phrase='Knowledge Products' fb='iogt'  svg="knowledge_products"   rgb='255, 204, 51, 0.2'></project-card>
          </div>
          <div class="project-info mdl-cell mdl-cell--12-col mdl-shadow--4dp">
            <h2 class="project-info__value">{{ _getProjectInfoValue(projects) }}</h2>
          </div>
        </div>
        <div class="project-list mdl-grid">
          <template is="dom-repeat" id='templateProjects' items="{{projects}}">
            <div class="mdl-cell mdl-cell--3-col mdl-cell--4-col-tablet mdl-cell--4-col-phone">
              <portfolio-project data={{projectsData}} index={{index}} svg={{selected}} item={{item}}></portfolio-project>
            </div>
          </template>
        </div>
      </div>
    </div>
  </template>
</dom-module>

<script>

  var projectCards = [
    { label: 'Products For Youth', key: 'youth_engagement', svg: 'youth_engagement' },
    { label: 'Real-time Information', key: 'real_time_info', svg: 'real_time_information' },
    { label: 'Infrastructure', key: 'infrastructure', svg: 'infrastructure' },
    { label: 'Knowledge Products', key: 'knowledge_p', svg: 'knowledge_products' }
  ];

  Polymer({
    is: 'all-projects',
    properties: {
      selected: {
        type: String,
        value: projectCards[0].key,
        notify: true
      },
      svg: {
        value: '',
        notify: true
      },
      url: {
        value: '/stats'
      },
      active: {
        type: Boolean,
        value: false,
        reflectToAttribute: true
      },
      location: {
        type: String,
        computed: '_computeLocation(selected)'
      },
      projectsData:{
        type: Object,
        observer: '_assignProjects'
      },
      projects: {
        type: Array
      },
      projectCards: {
        type: Array,
        value: projectCards
      }
    },

    _assignProjects: function(obj){
      if(Object.keys(obj).length > 0){
        this.projects = obj;
      }
    },

    _financial: function(data, kind){
      return [data.totals[kind], data.spents[kind]]
    },

    _computeLocation: function(route) {
       return "portfolios/" + route + '/projects';
    },

    _getProjectInfoValue(projects) {
      if (!projects.length) {
        return '';
      }
      return projects.length + ' project' + (projects.length > 1 ? 's' : '');
    },

    _getProjectContent(content, key) {
      return content[key];
    }
  })
</script>
